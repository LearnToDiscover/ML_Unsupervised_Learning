<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Data Handling: Image Handling</title><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" type="text/css" href="assets/styles.css"><script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png"><link rel="manifest" href="site.webmanifest"><link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"></head><body>
    <header id="top" class="navbar navbar-expand-md navbar-light bg-white top-nav l2d"><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-6">
      <div class="large-logo">
        <img alt="l2d" src="assets/images/l2d-logo.svg"></div>
    </div>
    <div class="selector-container">


      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/03-image_handling.html';">Instructor View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl navbar-light bg-white bottom-nav l2d" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="l2d" src="assets/images/l2d-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Data Handling
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Data Handling
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"></ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Data Handling
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 67%" class="percentage">
    67%
  </div>
  <div class="progress l2d">
    <div class="progress-bar l2d" role="progressbar" style="width: 67%" aria-valuenow="67" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar" style="display: flex">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle sticky-top" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner sticky-top">
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/03-image_handling.html">Instructor View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-data_frames_1.html">1. DataFrames - Part 1</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-data_frames_2.html">2. DataFrames - Part 2</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        3. Image Handling
        </span>
      </button>
    </div><!--/div.accordion-header-->

    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#challenge">Challenge</a></li>
<li><a href="#reading-and-processing-images"><strong>Reading and Processing Images</strong></a></li>
<li><a href="#reading-and-plotting-a-2-dimensional-image"><strong>Reading and Plotting a 2-Dimensional Image</strong></a></li>
<li><a href="#creating-an-image-mask"><strong>Creating an Image Mask</strong></a></li>
<li><a href="#colour-images">Colour Images</a></li>
<li><a href="#dealing-with-large-images"><strong>Dealing with Large Images</strong></a></li>
<li><a href="#d-images"><strong>3-D Images</strong></a></li>
<li><a href="#exercises">Exercises</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>

                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width resources"><a href="aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="02-data_frames_2.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="index.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="02-data_frames_2.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: DataFrames - Part 2
        </a>
        <a class="chapter-link float-end" href="index.html" rel="next">
          Home
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Image Handling</h1>
        <p>Last updated on 2025-01-05 |

        <a href="https://github.com/carpentries/workbench-template-rmd/edit/main/episodes/03-image_handling.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<p><a href="https://drive.usercontent.google.com/u/1/uc?id=1tM6WLCjhUMvn8fcTyms7CCnh5Wvh7__q&amp;export=download" class="external-link"><strong>Download
chapter PDF (.pdf).</strong></a></p>
<p><a href="https://drive.usercontent.google.com/u/1/uc?id=10XSHRRCH5Sa3JRtVy4utalwucgCAbgm2&amp;export=download" class="external-link"><strong>Download
chapter notebook (.ipynb).</strong></a></p>
<p><a href="https://docs.google.com/forms/d/e/1FAIpQLSdr0capF7jloJhPH3Pki1B3LZoKOG16poOpuVJ7SL2LkwLHQA/viewform?pli=1" class="external-link"><span style="color: rgb(255, 0, 0);"><strong>Mandatory Lesson Feedback
Survey</strong></span></a></p>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How to read and process images in Python?</li>
<li>How is an image mask created?</li>
<li>What are colour channels in images?</li>
<li>How do you deal with big images?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Understanding 2-dimensional greyscale images</li>
<li>Learning image masking</li>
<li>2-dimensional colour images and colour channels</li>
<li>Decreasing memory load when dealing with images</li>
</ul></div>
</div>
</div>
</div>
</div>
<br><p align="center">
<iframe width="560" height="315" src="https://www.youtube.com/embed/Wn2GCHu-Glw" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
</p>
<p><br></p>
<p align="center">
<iframe width="560" height="315" src="https://www.youtube.com/embed/JVx2szMOZc8" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
</p>
<p><br></p>
<p align="center">
<iframe width="560" height="315" src="https://www.youtube.com/embed/xJsCInqgLz4" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
</p>
<p><br></p>
<div id="prerequisites" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div id="prerequisites" class="callout-inner">
<h3 class="callout-title">Prerequisites</h3>
<div class="callout-content">
<ul><li>NumPy arrays</li>
<li>Plots and subplots with matplotlib</li>
</ul></div>
</div>
</div>
<div id="practice-exercises" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="practice-exercises" class="callout-inner">
<h3 class="callout-title">Practice Exercises</h3>
<div class="callout-content">
<p style="text-align: justify;">
This lesson has no explicit practice exercises. At each step, use images
of your own choice to practice. There are many image file formats,
different colour schemes etc for which you can try to find similar or
analogous solutions.
</p>
</div>
</div>
</div>
<section><h2 class="section-heading" id="challenge">Challenge<a class="anchor" aria-label="anchor" href="#challenge"></a></h2>
<hr class="half-width"></section><section><h2 class="section-heading" id="reading-and-processing-images"><strong>Reading and Processing Images</strong><a class="anchor" aria-label="anchor" href="#reading-and-processing-images"></a></h2>
<hr class="half-width"><p style="text-align: justify;">
In biology, we often deal with images; for example, microscopy and
different medical imaging modalities often output images and image data
for analysis. In many cases, we wish to extract some quantitative
information from these images. The focus of this lesson is to read and
process images in Python. This will include:
</p>
<ul><li>Working with 2-dimensional greyscale images</li>
<li>Creating and applying binary image masks</li>
<li>Working with 2-dimensional colour images, and interpreting colour
channels</li>
<li>Decreasing the memory for further processing by reducing resolution
or patching</li>
<li>Working with 3-dimensional images</li>
</ul><div class="section level3">
<h3 id="image-example"><strong>Image Example</strong><a class="anchor" aria-label="anchor" href="#image-example"></a></h3>
<p>The example in <a href="#ratCerebellum">Figure 1</a> is an image from
the cell <a href="http://cellimagelibrary.org/home" class="external-link">image library</a>
with the following description:</p>
<blockquote>
<p>“Midsaggital section of rat cerebellum, captured using confocal
imaging. Section shows inositol trisphosphate receptor (IP3R) labelled
in green, DNA in blue, and synaptophysin in magenta. Honorable Mention,
2010 Olympus BioScapes Digital Imaging Competition®.”</p>
</blockquote>
<p style="text-align: justify;">
Given this information, we might want to determine the relative amounts
of IP3R, DNA and synaptophysin in this image. This tutorial will guide
you through some of the steps to get you started with processing images
of all types, using Python. You can then refer back to this image
analysis example, and perform some analyses of your own.
</p>
<figure id="ratCerebellum"><img src="fig/rat_cerebellum.jpg" alt="Figure 1: Example image, rat cerebellum" class="figure mx-auto d-block"><div class="figcaption">Figure 1: Example image, rat cerebellum</div>
</figure></div>
<div class="section level3">
<h3 id="work-through-example">Work-Through Example<a class="anchor" aria-label="anchor" href="#work-through-example"></a></h3>
</div>
</section><section><h2 class="section-heading" id="reading-and-plotting-a-2-dimensional-image"><strong>Reading and Plotting a 2-Dimensional Image</strong><a class="anchor" aria-label="anchor" href="#reading-and-plotting-a-2-dimensional-image"></a></h2>
<hr class="half-width"><p style="text-align: justify;">
Firstly, we must read an image in. To demonstrate this we can use the
example of a histological slice through an axon bundle. We use
Matplotlib’s image module, from which we import the function
<code>imread</code>, used to store the image in a variable that we will
name <code>img</code>. The function <code>imread</code> can interpret
many different image formats, including .jpg, .png and .tif images.
</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="im">from</span> matplotlib.image <span class="im">import</span> imread</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>img <span class="op">=</span> imread(<span class="st">'fig/axon_slice.jpg'</span>)</span></code></pre>
</div>
<p>We can then check what type of variable is, using the type()
function:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">type</span>(img))</span></code></pre>
</div>
<p>&lt;class ‘numpy.ndarray’&gt;</p>
<p>This tells us that the image is stored in a NumPy array;
<code>ndarray</code> here refers to an N-dimensional array. We can check
some other properties of this array, for example, what the image
dimensions are, using the .shape attribute:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="bu">print</span>(img.shape)</span></code></pre>
</div>
<p>(2300, 3040)</p>
<p style="text-align: justify;">
This tells us that our image is composed of 2300 by 3040 data units, or
<em>pixels</em> as we are dealing with an image. The total number of
pixels in the image, is equivalent to its resolution. In digital
imaging, a pixel is simply a numerical value that represents either
intensity, in a greyscale image; or colour in a colour image. Therefore,
as data, a two-dimensional (2-D) greyscale image comprises a 2-D array
of these intensity values, or elements; hence the name ‘pixel’ is an
amalgamation of ‘picture’ and ‘element’. The array in our example has
two dimensions, and so we can expect the image to be 2-D as well. Let us
now use matplotlib.pyplot’s <code>imshow</code> function to plot the
image to see what it looks like. We can set the colour map to
<code>gray</code> in order to overwrite the default colour map.
</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="im">from</span> matplotlib.pyplot <span class="im">import</span> subplots, show</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>fig, ax <span class="op">=</span> subplots(figsize<span class="op">=</span>(<span class="dv">25</span>, <span class="dv">15</span>))</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>ax.imshow(img, cmap<span class="op">=</span><span class="st">'gray'</span>)<span class="op">;</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>show()</span></code></pre>
</div>
<figure><img src="fig/03-image_handling-rendered-unnamed-chunk-4-1.png" width="2400" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p style="text-align: justify;">
<code>imshow</code> has allowed us to plot the NumPy array of our image
data as a picture. The figure is divided up into a number of pixels, and
each of these is assigned an intensity value, which is held in the NumPy
array. Let’s have a closer look by selecting a smaller region of our
image and plotting that.
</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="im">from</span> matplotlib.pyplot <span class="im">import</span> subplots, show</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>fig, ax <span class="op">=</span> subplots(figsize<span class="op">=</span>(<span class="dv">25</span>, <span class="dv">15</span>))</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>ax.imshow(img[:<span class="dv">50</span>, :<span class="dv">70</span>], cmap<span class="op">=</span><span class="st">'gray'</span>)<span class="op">;</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>show()</span></code></pre>
</div>
<figure><img src="fig/03-image_handling-rendered-unnamed-chunk-5-3.png" width="2400" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p style="text-align: justify;">
By using <code>img[:50, :70]</code> we can select the first 50 values
from the first dimension, and the first 70 values from the second
dimension. Note that using a colon denotes ‘all’, where ‘:50’ is
inclusive of every number up to 50, for example. Thus, the image above
shows a very small part of the upper left corner of our original image.
As we are now zoomed in quite close to that corner, we can easily see
the individual pixels here.
</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>fig, ax <span class="op">=</span> subplots(figsize<span class="op">=</span>(<span class="dv">25</span>, <span class="dv">15</span>))</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>ax.imshow(img[:<span class="dv">20</span>, :<span class="dv">15</span>], cmap<span class="op">=</span><span class="st">'gray'</span>)<span class="op">;</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>show()</span></code></pre>
</div>
<figure><img src="fig/03-image_handling-rendered-unnamed-chunk-6-5.png" width="2400" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p style="text-align: justify;">
We have now displayed an even smaller section from that same upper left
corner of the image. Each square is a pixel and it has a single grey
value. Thus, the pixel intensity values are assigned by the numbers
stored in the NumPy array, <code>img</code>. Let us have a look at these
values by producing a slice from the array.
</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="bu">print</span>(img[:<span class="dv">20</span>, :<span class="dv">15</span>])</span></code></pre>
</div>
<p>[[ 18 9 3 4 4 1 2 7 6 8 10 12 13 14 13] [ 14 7 3 4 4 2 2 6 6 7 9 11
12 12 12] [ 8 3 1 3 5 3 2 4 6 7 8 9 10 10 9] [ 2 0 0 2 4 4 3 2 6 6 7 8 8
8 8] [ 0 0 0 1 3 5 3 1 6 6 7 7 8 9 10] [ 0 0 0 0 2 6 5 0 7 7 7 8 9 11
13] [ 0 2 1 0 1 6 5 1 8 8 8 10 11 14 17] [ 1 3 2 0 0 6 6 1 9 9 9 10 13
16 19] [ 1 0 0 1 4 7 8 8 10 12 15 16 18 20 24] [ 1 1 1 2 4 7 8 8 14 16
19 22 24 28 33] [ 4 5 5 6 8 10 12 13 19 22 26 30 34 40 46] [ 9 11 12 13
14 16 18 21 24 27 32 36 42 49 57] [ 12 15 17 18 19 21 25 28 32 34 38 43
49 57 65] [ 14 17 21 23 24 26 32 36 43 45 47 51 56 63 72] [ 18 23 28 31
31 35 41 47 56 57 58 60 64 70 78] [ 24 29 35 38 39 42 50 56 65 65 66 67
69 75 82] [ 32 39 40 44 51 48 52 69 77 82 83 80 81 89 94] [ 35 43 46 51
58 55 58 74 80 85 88 85 87 94 98] [ 38 50 56 61 69 66 67 80 85 90 94 95
97 102 105] [ 41 56 64 70 78 76 75 84 90 95 100 104 106 109 111]]</p>
<p>Each of these numbers corresponds to an intensity in the specified
colourmap. These numbers range from 0 to 255, implying 256 shades of
grey.</p>
<p style="text-align: justify;">
We chose <code>cmap = gray</code>, which assigns darker grey colours to
smaller numbers, and lighter grey colours to higher numbers. However, we
can also pick a non-greyscale colour map to plot the same image. We can
even display a colourbar to keep track of the intensity values.
Matplotlib has a diverse palette of colour maps that you can look
through, linked <a href="https://matplotlib.org/tutorials/colors/colormaps.html" class="external-link">here</a>.
Let’s take a look at two commonly-used Matplotlib colour maps called
<code>viridis</code> and <code>magma</code>:
</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>fig, ax <span class="op">=</span> subplots(nrows<span class="op">=</span><span class="dv">1</span>, ncols<span class="op">=</span><span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">25</span>, <span class="dv">15</span>))</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>p1 <span class="op">=</span> ax[<span class="dv">0</span>].imshow(img[:<span class="dv">20</span>, :<span class="dv">15</span>], cmap<span class="op">=</span><span class="st">'viridis'</span>)</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>p2 <span class="op">=</span> ax[<span class="dv">1</span>].imshow(img[:<span class="dv">20</span>, :<span class="dv">15</span>], cmap<span class="op">=</span><span class="st">'magma'</span>)</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>fig.colorbar(p1, ax<span class="op">=</span>ax[<span class="dv">0</span>], shrink <span class="op">=</span> <span class="fl">0.8</span>)</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>fig.colorbar(p2, ax<span class="op">=</span>ax[<span class="dv">1</span>], shrink <span class="op">=</span> <span class="fl">0.8</span>)<span class="op">;</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>show()</span></code></pre>
</div>
<figure><img src="fig/03-image_handling-rendered-unnamed-chunk-8-7.png" width="2400" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p style="text-align: justify;">
Note, that even though we can plot our greyscale image with colourful
colour schemes, it still does not qualify as a colour image. These are
just false-colour, Matplotlib-overlayed interpretations of rudimentary
intensity values. The reason for this is that a pixel in a standard
colour image actually comprises <strong>three sets</strong> of
intensities per pixel; not just the one, as in this greyscale example.
In the case above, the number in the array represented a grey value and
the colour was assigned to that grey value by <code>Matplotlib</code>.
These represent ‘false’ colours.
</p>
</section><section><h2 class="section-heading" id="creating-an-image-mask"><strong>Creating an Image Mask</strong><a class="anchor" aria-label="anchor" href="#creating-an-image-mask"></a></h2>
<hr class="half-width"><p>Now that we know that images essentially comprise arrays of numerical
intensities held in a NumPy array, we can start processing images using
these numbers.</p>
<p style="text-align: justify;">
As an initial approach, we can plot a histogram of the intensity values
that comprise an image. We can make use of the <code>.flatten()</code>
method to turn the original 2300 x 3040 array into a one-dimensional
array with 6,992,000 values. This rearrangement allows the numbers
within the image to be represented by a single column inside a matrix or
DataFrame.
</p>
<p>The histogram plot shows how several instances of each intensity make
up this image:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>fig, ax <span class="op">=</span> subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">4</span>))</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>ax.hist(img.flatten(), bins <span class="op">=</span> <span class="dv">50</span>)</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Pixel intensity"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)<span class="op">;</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>show()</span></code></pre>
</div>
<figure><img src="fig/03-image_handling-rendered-unnamed-chunk-9-9.png" width="960" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
The histogram is a distribution, with intensities mostly lying between
values of 50 and 250.
<p style="text-align: justify;">
The image displays a slice through an axon bundle. For the sake of
example, let’s say that we are now interested in the myelin sheath
surrounding the axons (the dark rings). We can create a
<strong>mask</strong> that isolates pixels whose intensity value is
below a certain threshold (because darker pixels have lower intensity
values). Everything below this threshold can be assigned to, for
instance, a value of 1 (representing True), and everything above will be
assigned a value of 0 (representing False). This is called a binary or
Boolean mask.
</p>
<p style="text-align: justify;">
Based on the histogram above, we might want to try adjusting that
threshold somewhere between 100 and 200. Let’s see what we get with a
threshold set to 125. Firstly, we must implement a conditional statement
in order to create the mask. It is then possible to apply this mask to
the image. The result can be that we plot both the mask and the masked
image.
</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>threshold <span class="op">=</span> <span class="dv">125</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>mask <span class="op">=</span> img <span class="op">&lt;</span> threshold</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>img_masked <span class="op">=</span> img<span class="op">*</span>mask</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>fig, ax <span class="op">=</span> subplots(nrows<span class="op">=</span><span class="dv">1</span>, ncols<span class="op">=</span><span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">10</span>))</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>ax[<span class="dv">0</span>].imshow(mask, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a>ax[<span class="dv">0</span>].set_title(<span class="st">'Binary mask'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a>ax[<span class="dv">1</span>].imshow(img_masked, cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a>ax[<span class="dv">1</span>].set_title(<span class="st">'Masked image'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a>show()</span></code></pre>
</div>
<figure><img src="fig/03-image_handling-rendered-unnamed-chunk-10-11.png" width="1920" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p style="text-align: justify;">
The left subplot shows the binary mask itself. White represents values
where our condition is true, and black where our condition is false. The
right image shows the original image after we have applied the binary
mask, it shows the original pixel intensities in regions where the mask
value is true.
</p>
<p style="text-align: justify;">
Note that applying the mask means that the intensities where the
condition is true are left unchanged. The intensities where the
condition is false are multiplied by zero, and therefore set to zero.
</p>
<p>Let’s have a look at the resulting image histograms.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>fig, ax <span class="op">=</span> subplots(nrows<span class="op">=</span><span class="dv">1</span>, ncols<span class="op">=</span><span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">5</span>))</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>ax[<span class="dv">0</span>].hist(img_masked.flatten(), bins<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>ax[<span class="dv">0</span>].set_title(<span class="st">'Histogram of masked image'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>ax[<span class="dv">0</span>].set_xlabel(<span class="st">"Pixel intensity"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>ax[<span class="dv">1</span>].hist(img_masked[img_masked <span class="op">!=</span> <span class="dv">0</span>].flatten(), bins<span class="op">=</span><span class="dv">25</span>)</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>ax[<span class="dv">1</span>].set_title(<span class="st">'Histogram of masked image after zeros are removed'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>ax[<span class="dv">1</span>].set_xlabel(<span class="st">"Pixel intensity"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>show()</span></code></pre>
</div>
<figure><img src="fig/03-image_handling-rendered-unnamed-chunk-11-13.png" width="1920" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p style="text-align: justify;">
The left subplot displays the values for the masked image. Note that
there is a large peak at zero, as a large part of the image is masked.
The right subplot histogram, however, displays only the non-zero pixel
intensities. From this, we can see that our mask has worked as expected,
where only values up to 125 are found. This is because our threshold
causes a sharp cut-off at a pixel intensity of 125.
</p>
</section><section><h2 class="section-heading" id="colour-images">Colour Images<a class="anchor" aria-label="anchor" href="#colour-images"></a></h2>
<hr class="half-width"><p style="text-align: justify;">
So far, our image has had a single intensity value for each pixel. In
colour images, we have multiple channels of information per pixel; most
commonly, colour images are RGB, comprising three corresponding to
intensities of red, green and blue. There are many other formats of
colour image, but these will be beyond the scope of this lesson. In a
RGB colour image, any colour will be a composite of the intensity value
for each of these colours. Our chosen example for a colour image is one
of the rat cerebellar cortex. Let us firstly import it and check its
shape.
</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>img_col <span class="op">=</span> imread(<span class="st">'fig/rat_brain_low_res.jpg'</span>)</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>img_col.shape</span></code></pre>
</div>
<p>(929, 1000, 3)</p>
<p style="text-align: justify;">
Our image array now contains three dimensions: the first two are the
spatial dimensions corresponding to the pixel positions as x-y
coordinates. The third dimension contains the three colour channels,
corresponding to three layers of intensity values (red, blue and green)
on top of each other, per pixel. First, let us plot the entire image
using Matplotlib’s imshow method.
</p>
<p>First, let us plot the whole image.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>fig, ax <span class="op">=</span> subplots(figsize<span class="op">=</span>(<span class="dv">25</span>, <span class="dv">15</span>))</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>ax.imshow(img_col)<span class="op">;</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>show()</span></code></pre>
</div>
<figure><img src="fig/03-image_handling-rendered-unnamed-chunk-13-15.png" width="2400" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
The sample is labeled for Hoechst stain (blue), the Inositol
trisphosphate (IP3) receptor (green) and Glial fibrillary acidic protein
(GFAP) (red).
<p style="text-align: justify;">
We can then visualise the three colour channels individually by slicing
the NumPy array comprising our image. The stack with index 0 corresponds
to ‘red’, index 1 corresponds to ‘green’ and index 2 corresponds to
‘blue’:
</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>red_channel   <span class="op">=</span> img_col[:, :, <span class="dv">0</span>]</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>green_channel <span class="op">=</span> img_col[:, :, <span class="dv">1</span>]</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>blue_channel  <span class="op">=</span> img_col[:, :, <span class="dv">2</span>]</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>fig, ax <span class="op">=</span> subplots(nrows<span class="op">=</span><span class="dv">1</span>, ncols<span class="op">=</span><span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">10</span>))</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>imgplot_red <span class="op">=</span> ax[<span class="dv">0</span>].imshow(red_channel, cmap<span class="op">=</span><span class="st">"Reds"</span>)</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>imgplot_green <span class="op">=</span> ax[<span class="dv">1</span>].imshow(green_channel, cmap<span class="op">=</span><span class="st">"Greens"</span>)</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>imgplot_blue <span class="op">=</span> ax[<span class="dv">2</span>].imshow(blue_channel, cmap<span class="op">=</span><span class="st">"Blues"</span>)</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>fig.colorbar(imgplot_red, ax<span class="op">=</span>ax[<span class="dv">0</span>], shrink<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>fig.colorbar(imgplot_green, ax<span class="op">=</span>ax[<span class="dv">1</span>], shrink<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a>fig.colorbar(imgplot_blue, ax<span class="op">=</span>ax[<span class="dv">2</span>], shrink<span class="op">=</span><span class="fl">0.4</span>)<span class="op">;</span></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a>show()</span></code></pre>
</div>
<figure><img src="fig/03-image_handling-rendered-unnamed-chunk-15-17.png" width="1920" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p style="text-align: justify;">
This shows what colour combinations each of the pixels is made up of.
Notice that the intensities go up to 255. This is because RGB (red,
green and blue) colours are defined within an intensity range of 0-255.
This gives a vast total 16,777,216 possible colour combinations.
</p>
<p>We can plot histograms of each of the colour channels.</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>fig, ax <span class="op">=</span> subplots(nrows<span class="op">=</span><span class="dv">1</span>, ncols<span class="op">=</span><span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">5</span>))</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>ax[<span class="dv">0</span>].hist(red_channel.flatten(), bins<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>ax[<span class="dv">0</span>].set_xlabel(<span class="st">"Pixel intensity"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>ax[<span class="dv">0</span>].set_xlabel(<span class="st">"Red channel"</span>)</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>ax[<span class="dv">1</span>].hist(green_channel.flatten(), bins<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>ax[<span class="dv">1</span>].set_xlabel(<span class="st">"Pixel intensity"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a>ax[<span class="dv">1</span>].set_xlabel(<span class="st">"Green channel"</span>)</span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a>ax[<span class="dv">2</span>].hist(blue_channel.flatten(), bins<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a>ax[<span class="dv">2</span>].set_xlabel(<span class="st">"Pixel intensity"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a>ax[<span class="dv">2</span>].set_xlabel(<span class="st">"Blue channel"</span>)</span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a>show()</span></code></pre>
</div>
<figure><img src="fig/03-image_handling-rendered-unnamed-chunk-16-19.png" width="1920" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></section><section><h2 class="section-heading" id="dealing-with-large-images"><strong>Dealing with Large Images</strong><a class="anchor" aria-label="anchor" href="#dealing-with-large-images"></a></h2>
<hr class="half-width"><p style="text-align: justify;">
Often, we encounter situations where we have to deal with very large
images that are composed of many pixels. Images such as these are often
difficult to process, as they can require a lot of computer memory to do
so. We will explore two different strategies for dealing with this
problem - decreasing resolution, and using patches from the original
image. To demonstrate this, we can make use of the full-resolution
version of the rat brain image in the previous example.
</p>
<p style="text-align: justify;">
Since the file is quite large, and this is an instructional course where
you may wish to use one of our provided GitHub Codespaces to practise
these examples, we will use an online, remotely-hosted copy of the
image.
</p>
<p style="text-align: justify;">
In order to do this, we will firstly store our image URL in a variable
for ease of handling:
</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="co"># URL to the remotely hosted PNG image</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://media.githubusercontent.com/media/L2D-Assets/Assets/refs/heads/master/rat_brain.png"</span></span></code></pre>
</div>
<p style="text-align: justify;">
Next, we must bypass the validation of the server’s certificate, for
ease. SSL stands for Secure Sockets Layer, which is a standard way of
providing an encrypted connection between a server and a client. As this
is an instructional material, we are disabling this, as we trust the
issuing author of the source file (ourselves).
</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="im">import</span> ssl</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a><span class="co"># Disable SSL verification</span></span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>ssl_context <span class="op">=</span> ssl._create_unverified_context()</span></code></pre>
</div>
<p style="text-align: justify;">
Lastly, we must then import the function <code>urlopen</code> and the
class <code>BytesIO</code>, where the former allows us to open the URL
as raw binary data, and the latter wraps this into memory, simulating a
file object. This allows us to work with this online, remotely-hosted
large image, from its remote location. Please be patient - this step can
take time, and will depend on the speed of your internet connection.
</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="im">from</span> urllib.request <span class="im">import</span> urlopen</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="im">from</span> io <span class="im">import</span> BytesIO</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="co"># Consolidate into 'remote_image'</span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>remote_image <span class="op">=</span> BytesIO(urlopen(url, context<span class="op">=</span>ssl_context).read())</span></code></pre>
</div>
<p style="text-align: justify;">
Next, we can read the image into Python, using the imread() function.
However, if we do this plainly, we will receive a warning from Python
indicating that the “Image size (324649360 pixels) exceeds limit of
178956970 pixels, could be decompression bomb DOS attack.” This is
alludes to a potential malicious file, designed to crash or cause
disruption by using consuming large amounts of memory.
</p>
<div id="note" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="note" class="callout-inner">
<h3 class="callout-title">Note</h3>
<div class="callout-content">
<p>This demonstrates how to read a remotely-hosted image into memory,
and code using this. However, if you wish to try this with a large image
stored locally on your computer you can bypass the steps above and use
the lines of code that is commented out in the cells below, instead of
the line directly above.</p>
</div>
</div>
</div>

<p>We can get around this by changing the maximum pixel limit, for which
we will require the Image module from the Python Imaging Library (PIL).
We will make use of the <code>MAX_IMAGE_PIXELS</code> class-level
attribute in order to do this, as follows:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a><span class="co"># Disables the decompression bomb check:</span></span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>Image.MAX_IMAGE_PIXELS <span class="op">=</span> <span class="dv">1000000000</span></span></code></pre>
</div>
<p>Let’s try to use <code>imread</code>, again. Please be patient, as
this may take a moment to execute.</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="co"># Use 'remote_image' with imread:</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>img_hr <span class="op">=</span> imread(remote_image)</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a><span class="co"># img_hr = imread('fig/rat_brain.png') # Or for local image processing.</span></span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>img_hr.shape</span></code></pre>
</div>
<p>(17360, 18701, 3)</p>
<p>Now we can plot the full high-resolution image:</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>fig, ax <span class="op">=</span> subplots(figsize<span class="op">=</span>(<span class="dv">25</span>, <span class="dv">15</span>))</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a>ax.imshow(img_hr, cmap<span class="op">=</span><span class="st">'gray'</span>)<span class="op">;</span></span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a>show()</span></code></pre>
</div>
<figure><img src="fig/03-image_handling-rendered-unnamed-chunk-22-21.png" width="2400" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p style="text-align: justify;">
Although now we can plot this image, it does still consist of over 300
million pixels, which could run us into memory problems when attempting
to process it. One approach is simply to reduce the resolution by
importing the image using the Image module from the PIL library: which
we imported in the code given, above. This library gives us a wealth of
tools to process images, including methods to decrease an image’s
resolution. PIL is a very rich library with a multitude of useful tools.
As always, having a look at the official <a href="https://pillow.readthedocs.io/en/stable/" class="external-link">documentation</a> and
playing around with it yourself is highly encouraged.
</p>
<p>We can make use of the <code>resize</code> method to downsample the
image, providing the desired width and height as numerical arguments, as
follows:</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="co"># Open the remotely hosted image:</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>img_pil <span class="op">=</span> Image.<span class="bu">open</span>(remote_image) </span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a><span class="co"># img_pil = Image.open('fig/rat_brain.png') # Or for local image processing.</span></span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a>img_small <span class="op">=</span> img_pil.resize((<span class="dv">174</span>, <span class="dv">187</span>))</span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">type</span>(img_small))</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;class 'PIL.Image.Image'&gt;</code></pre>
</div>
<p>Plotting should now be considerably quicker.</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>fig, ax <span class="op">=</span> subplots(figsize<span class="op">=</span>(<span class="dv">25</span>, <span class="dv">15</span>))</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>ax.imshow(img_small, cmap<span class="op">=</span><span class="st">'gray'</span>)<span class="op">;</span></span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>show()</span></code></pre>
</div>
<figure><img src="fig/03-image_handling-rendered-unnamed-chunk-24-23.png" width="2400" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p style="text-align: justify;">
Using the above code, we have successfully resized the image to a
resolution of 174 x 187 pixels. It is, however, important to note that
our image is no longer in the format of a NumPy array, but rather it now
has the type <code>PIL.Image.Image</code>. We can, however, easily
convert it back into a NumPy array using the array function, if we so
wish.
</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="im">from</span> numpy <span class="im">import</span> array</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a>img_numpy <span class="op">=</span> array(img_small)</span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">type</span>(img_numpy))</span></code></pre>
</div>
<p>&lt;class ‘numpy.ndarray’&gt;</p>
<p style="text-align: justify;">
Despite the above, it is often desired to keep images in their full
resolution, as resizing effectively results in a loss of information. An
commonly used, alternative approach to such downsampling is to
<strong>patch</strong> the images. Patching an image essentially divides
the picture up into smaller chunks that are termed patches.
</p>
<p>For this, we can implement functionality from the <a href="https://scikit-learn.org/stable/" class="external-link">Scikit-Learn</a> machine
learning library.</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="im">from</span> sklearn.feature_extraction.image <span class="im">import</span> extract_patches_2d</span></code></pre>
</div>
<p>The <code>extract_patches_2d</code> function is used to extract parts
of the image. The shape of each patch, together with the maximal number
of patches, can be specified, as follows:</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a>patches <span class="op">=</span> extract_patches_2d(img_hr, (<span class="dv">174</span>, <span class="dv">187</span>), max_patches<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a>patches.shape</span></code></pre>
</div>
<p>(100, 174, 187, 3)</p>
<p style="text-align: justify;">
When using the <code>.shape</code> attribute, the output given here
shows that the image has been successfully subdivided into 100 patches,
with resolution 174 x 187 pixels, across three channels: red, blue and
green (as this is an RGB, colour image). Note that patching itself can
be a memory-intensive task. Extracting lots and lots of patches may take
a long time. To look at the patches, we can make use of a for loop to
iterate through the first element of the <code>.shape</code> array (the
100 patches), and visualise each one on its own subplot using the
<code>.imshow</code> method, as follows:
</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a>fig, ax <span class="op">=</span> subplots(nrows<span class="op">=</span><span class="dv">10</span>, ncols<span class="op">=</span><span class="dv">10</span>, figsize<span class="op">=</span>(<span class="dv">25</span>, <span class="dv">25</span>))</span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a>ax <span class="op">=</span> ax.flatten()</span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a><span class="cf">for</span> index <span class="kw">in</span> <span class="bu">range</span>(patches.shape[<span class="dv">0</span>]):</span>
<span id="cb29-6"><a href="#cb29-6" tabindex="-1"></a>    ax[index].imshow(patches[index, :, :, :])</span>
<span id="cb29-7"><a href="#cb29-7" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" tabindex="-1"></a>show()</span></code></pre>
</div>
<figure><img src="fig/03-image_handling-rendered-unnamed-chunk-28-25.png" width="2400" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Working with these smaller, individual patches will be much more
manageable and computationally resourceful.</p>
</section><section><h2 class="section-heading" id="d-images"><strong>3-D Images</strong><a class="anchor" aria-label="anchor" href="#d-images"></a></h2>
<hr class="half-width"><p style="text-align: justify;">
So far, we have covered how to handle two-dimensional image data in a
variety of ways. But scenarios will often arise whereby the analysis of
three-dimensional image data is required. A good example of such 3-D
images that is commonly encountered, is MRI scans. These don’t natively
exist as .csv format, but are often delivered in specialised image
formats. One such format is nii: the <strong>Neuroimaging Informatics
Technology Initiative (NIfTI)</strong> open file format. Handling these
types of images requires specialised software. In particular, we will be
using an open-source library called <strong>nibabel</strong>.
Documentation for this package is available at <a href="https://nipy.org/nibabel/" class="external-link uri">https://nipy.org/nibabel/</a>.
</p>
<p>As it is not contained in your Python installation by default, it
needs to be installed first.</p>
<p>Two methods for installing this, are given here. If you have
previously installed the <strong>Anaconda distribution</strong> of
Python, paste the following onto your command line or terminal, and hit
return:</p>
<pre><code>conda install -c conda-forge nibabel</code></pre>
<p>Alternatively, you can also install it using Python’s default package
installer ‘pip’ by pasting the following onto your command line or
terminal, and hitting return:</p>
<pre><code>pip install nibabel</code></pre>
<p>in your command line or terminal.</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="im">import</span> nibabel <span class="im">as</span> nib</span></code></pre>
</div>
<p>The package is now available for use. To shorten how we call on the
nibabel package in our code, we can use the above import statement,
using the alias nib to refer to <code>nibabel</code>. Thus we can call
on any function in nibabel, by using <code>nib</code> is followed by a
period and the name of that specific function, as follows:</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a>img_3d <span class="op">=</span> nib.load(<span class="st">'fig/brain.nii'</span>)</span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a>img_data <span class="op">=</span> img_3d.get_fdata()</span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">type</span>(img_data))</span></code></pre>
</div>
<p>&lt;class ‘numpy.memmap’&gt;</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a><span class="bu">print</span>(img_data.shape)</span></code></pre>
</div>
<p>(256, 256, 124)</p>
<p style="text-align: justify;">
We can see that the .shape attribute revelas that this image has three
dimensions, and a total of 256 x 256 x 124 volume pixels (or voxels). To
visualise our image, we can plot one slice at a time. The example below
shows three different slices, in the transverse direction (from chin to
the top of the head). To access an image across the transverse
orientation, a single value is selected from the third dimension of the
image, as follows. As always, the colons indicate that all data on the
remaining two axes is selected and visualised:
</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a>fig, ax <span class="op">=</span> subplots(ncols<span class="op">=</span><span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">25</span>, <span class="dv">15</span>))</span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" tabindex="-1"></a>p1 <span class="op">=</span> ax[<span class="dv">0</span>].imshow(img_data[:, :, <span class="dv">60</span>], cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb35-4"><a href="#cb35-4" tabindex="-1"></a>p2 <span class="op">=</span> ax[<span class="dv">1</span>].imshow(img_data[:, :, <span class="dv">75</span>], cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb35-5"><a href="#cb35-5" tabindex="-1"></a>p3 <span class="op">=</span> ax[<span class="dv">2</span>].imshow(img_data[:, :, <span class="dv">90</span>], cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb35-6"><a href="#cb35-6" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" tabindex="-1"></a>fig.colorbar(p1, ax<span class="op">=</span>ax[<span class="dv">0</span>], shrink<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb35-8"><a href="#cb35-8" tabindex="-1"></a>fig.colorbar(p2, ax<span class="op">=</span>ax[<span class="dv">1</span>], shrink<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb35-9"><a href="#cb35-9" tabindex="-1"></a>fig.colorbar(p3, ax<span class="op">=</span>ax[<span class="dv">2</span>], shrink<span class="op">=</span><span class="fl">0.4</span>)<span class="op">;</span></span>
<span id="cb35-10"><a href="#cb35-10" tabindex="-1"></a></span>
<span id="cb35-11"><a href="#cb35-11" tabindex="-1"></a>show()</span></code></pre>
</div>
<figure><img src="fig/03-image_handling-rendered-unnamed-chunk-31-27.png" width="2400" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>These look fairly dark. We can improve the contrast, by adjusting the
intensity range. This requires intentionally overriding the default
values, and specifying our own for the keyword arguments
<code>vmin</code> and <code>vmax</code>.</p>
<p style="text-align: justify;">
The <code>vmin</code> and <code>vmax</code> parameters in matplotlib
define the data range that the colormap (in our case the
<code>grey</code> map) covers; thus they control the range of data
values indicated by the colormap in use. By default, the colormap covers
the complete value range of the supplied data. For instance, in many
images this will typically be somewhere between 0 and 255. If we want to
brighten up the darker shades of grey in our example MRI slices, for
example, we can reduce the value of the <code>vmax</code> parameter.
</p>
<p>Expanding upon the above code:</p>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a>fig, ax <span class="op">=</span> subplots(ncols<span class="op">=</span><span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">25</span>, <span class="dv">15</span>))</span>
<span id="cb36-2"><a href="#cb36-2" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" tabindex="-1"></a>p1 <span class="op">=</span> ax[<span class="dv">0</span>].imshow(img_data[:, :, <span class="dv">60</span>], cmap<span class="op">=</span><span class="st">'gray'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">150</span>)</span>
<span id="cb36-4"><a href="#cb36-4" tabindex="-1"></a>p2 <span class="op">=</span> ax[<span class="dv">1</span>].imshow(img_data[:, :, <span class="dv">75</span>], cmap<span class="op">=</span><span class="st">'gray'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">150</span>)</span>
<span id="cb36-5"><a href="#cb36-5" tabindex="-1"></a>p3 <span class="op">=</span> ax[<span class="dv">2</span>].imshow(img_data[:, :, <span class="dv">90</span>], cmap<span class="op">=</span><span class="st">'gray'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">150</span>)</span>
<span id="cb36-6"><a href="#cb36-6" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" tabindex="-1"></a>fig.colorbar(p1, ax<span class="op">=</span>ax[<span class="dv">0</span>], shrink<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb36-8"><a href="#cb36-8" tabindex="-1"></a>fig.colorbar(p2, ax<span class="op">=</span>ax[<span class="dv">1</span>], shrink<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb36-9"><a href="#cb36-9" tabindex="-1"></a>fig.colorbar(p3, ax<span class="op">=</span>ax[<span class="dv">2</span>], shrink<span class="op">=</span><span class="fl">0.4</span>)<span class="op">;</span></span>
<span id="cb36-10"><a href="#cb36-10" tabindex="-1"></a></span>
<span id="cb36-11"><a href="#cb36-11" tabindex="-1"></a>show()</span></code></pre>
</div>
<figure><img src="fig/03-image_handling-rendered-unnamed-chunk-32-29.png" width="2400" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>What about the other dimensions? We can also plot coronal and
sagittal slices, for example. But take note that, in this case, the
respective slices have different pixel resolutions. Let us expand our
code even further, to display all three desired viewing planes in our
MRI scan, as follows:</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a>fig, ax <span class="op">=</span> subplots(nrows<span class="op">=</span><span class="dv">3</span>, ncols<span class="op">=</span><span class="dv">5</span>, figsize<span class="op">=</span>(<span class="dv">26</span>, <span class="dv">18</span>))</span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" tabindex="-1"></a>t1 <span class="op">=</span> ax[<span class="dv">0</span>, <span class="dv">0</span>].imshow(img_data[:, :, <span class="dv">45</span>].T, cmap<span class="op">=</span><span class="st">'gray'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">150</span>, origin<span class="op">=</span><span class="st">'lower'</span>)</span>
<span id="cb37-4"><a href="#cb37-4" tabindex="-1"></a>t2 <span class="op">=</span> ax[<span class="dv">0</span>, <span class="dv">1</span>].imshow(img_data[:, :, <span class="dv">60</span>].T, cmap<span class="op">=</span><span class="st">'gray'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">150</span>, origin<span class="op">=</span><span class="st">'lower'</span>)</span>
<span id="cb37-5"><a href="#cb37-5" tabindex="-1"></a>t3 <span class="op">=</span> ax[<span class="dv">0</span>, <span class="dv">2</span>].imshow(img_data[:, :, <span class="dv">75</span>].T, cmap<span class="op">=</span><span class="st">'gray'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">150</span>, origin<span class="op">=</span><span class="st">'lower'</span>)</span>
<span id="cb37-6"><a href="#cb37-6" tabindex="-1"></a>t4 <span class="op">=</span> ax[<span class="dv">0</span>, <span class="dv">3</span>].imshow(img_data[:, :, <span class="dv">90</span>].T, cmap<span class="op">=</span><span class="st">'gray'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">150</span>, origin<span class="op">=</span><span class="st">'lower'</span>)</span>
<span id="cb37-7"><a href="#cb37-7" tabindex="-1"></a>t5 <span class="op">=</span> ax[<span class="dv">0</span>, <span class="dv">4</span>].imshow(img_data[:, :, <span class="dv">105</span>].T, cmap<span class="op">=</span><span class="st">'gray'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">150</span>, origin<span class="op">=</span><span class="st">'lower'</span>)</span>
<span id="cb37-8"><a href="#cb37-8" tabindex="-1"></a></span>
<span id="cb37-9"><a href="#cb37-9" tabindex="-1"></a>c1 <span class="op">=</span> ax[<span class="dv">1</span>, <span class="dv">0</span>].imshow(img_data[:, <span class="dv">50</span>, :].T, cmap<span class="op">=</span><span class="st">'gray'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">150</span>, origin<span class="op">=</span><span class="st">'lower'</span>)</span>
<span id="cb37-10"><a href="#cb37-10" tabindex="-1"></a>c2 <span class="op">=</span> ax[<span class="dv">1</span>, <span class="dv">1</span>].imshow(img_data[:, <span class="dv">75</span>, :].T, cmap<span class="op">=</span><span class="st">'gray'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">150</span>, origin<span class="op">=</span><span class="st">'lower'</span>)</span>
<span id="cb37-11"><a href="#cb37-11" tabindex="-1"></a>c3 <span class="op">=</span> ax[<span class="dv">1</span>, <span class="dv">2</span>].imshow(img_data[:, <span class="dv">90</span>, :].T, cmap<span class="op">=</span><span class="st">'gray'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">150</span>, origin<span class="op">=</span><span class="st">'lower'</span>)</span>
<span id="cb37-12"><a href="#cb37-12" tabindex="-1"></a>c4 <span class="op">=</span> ax[<span class="dv">1</span>, <span class="dv">3</span>].imshow(img_data[:, <span class="dv">105</span>, :].T, cmap<span class="op">=</span><span class="st">'gray'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">150</span>, origin<span class="op">=</span><span class="st">'lower'</span>)</span>
<span id="cb37-13"><a href="#cb37-13" tabindex="-1"></a>c5 <span class="op">=</span> ax[<span class="dv">1</span>, <span class="dv">4</span>].imshow(img_data[:, <span class="dv">120</span>, :].T, cmap<span class="op">=</span><span class="st">'gray'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">150</span>, origin<span class="op">=</span><span class="st">'lower'</span>)</span>
<span id="cb37-14"><a href="#cb37-14" tabindex="-1"></a></span>
<span id="cb37-15"><a href="#cb37-15" tabindex="-1"></a>s1 <span class="op">=</span> ax[<span class="dv">2</span>, <span class="dv">0</span>].imshow(img_data[<span class="dv">75</span>, :, :].T, cmap<span class="op">=</span><span class="st">'gray'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">150</span>, origin<span class="op">=</span><span class="st">'lower'</span>)</span>
<span id="cb37-16"><a href="#cb37-16" tabindex="-1"></a>s2 <span class="op">=</span> ax[<span class="dv">2</span>, <span class="dv">1</span>].imshow(img_data[<span class="dv">90</span>, :, :].T, cmap<span class="op">=</span><span class="st">'gray'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">150</span>, origin<span class="op">=</span><span class="st">'lower'</span>)</span>
<span id="cb37-17"><a href="#cb37-17" tabindex="-1"></a>s3 <span class="op">=</span> ax[<span class="dv">2</span>, <span class="dv">2</span>].imshow(img_data[<span class="dv">105</span>, :, :].T, cmap<span class="op">=</span><span class="st">'gray'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">150</span>, origin<span class="op">=</span><span class="st">'lower'</span>)</span>
<span id="cb37-18"><a href="#cb37-18" tabindex="-1"></a>s4 <span class="op">=</span> ax[<span class="dv">2</span>, <span class="dv">3</span>].imshow(img_data[<span class="dv">120</span>, :, :].T, cmap<span class="op">=</span><span class="st">'gray'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">150</span>, origin<span class="op">=</span><span class="st">'lower'</span>)</span>
<span id="cb37-19"><a href="#cb37-19" tabindex="-1"></a>s5 <span class="op">=</span> ax[<span class="dv">2</span>, <span class="dv">4</span>].imshow(img_data[<span class="dv">135</span>, :, :].T, cmap<span class="op">=</span><span class="st">'gray'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">150</span>, origin<span class="op">=</span><span class="st">'lower'</span>)<span class="op">;</span></span>
<span id="cb37-20"><a href="#cb37-20" tabindex="-1"></a></span>
<span id="cb37-21"><a href="#cb37-21" tabindex="-1"></a>show()</span></code></pre>
</div>
<figure><img src="fig/03-image_handling-rendered-unnamed-chunk-33-31.png" width="2496" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>The result is that we have clearly visualised slices of our 3-D
image, representing all three viewing planes in this 3-dimensional brain
scan.</p>
</section><section><h2 class="section-heading" id="exercises">Exercises<a class="anchor" aria-label="anchor" href="#exercises"></a></h2>
<hr class="half-width"><div id="end-of-chapter-exercises" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="end-of-chapter-exercises" class="callout-inner">
<h3 class="callout-title">End of chapter Exercises</h3>
<div class="callout-content">
<p><strong>Assignment</strong></p>
<p>Using the image from the beginning of this lesson
(rat_cerebellum.jpg) to perform the following tasks:</p>
<ol style="list-style-type: decimal"><li><p>Import the image and display it.</p></li>
<li><p>Show histograms for each of the colour channels and plot the
contributions of each of the RGB colours to the final image,
separately.</p></li>
<li><p>Create three different binary masks using manually determined
thresholds: one for mostly red pixels, one for mostly green pixels, and
one for mostly blue pixels. Note that you can apply conditions that are
either greater or smaller than a threshold of your choice.</p></li>
<li><p>Plot the three masks and the corresponding masked
images.</p></li>
<li><p>Using your masks, approximate the relative amounts of
synaptophysin, IP3R, and DNA in the image. To do this, you can assume
that the number of red pixels represents synaptophysin, green pixels
represents IP3R and blue pixels represent DNA. The results will vary
depending on the setting of the thresholds. How do different threshold
values change your results?</p></li>
<li><p>Change the resolution of your image to different values. How does
the resolution affect your results?</p></li>
</ol></div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Solutions are provided after assignments are marked.
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">

</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul><li>The <code>imread</code> function can be used to read in and
interpret multiple image formats.</li>
<li>Masking isolates pixels whose intensity value is below a certain
threshold.</li>
<li>Colour images typically comprise three channels (corresponding to
red, green and blue intensities).</li>
<li>Python Imaging Library (PIL) helps to set and raise default pixel
limits for reading in and handling larger images.</li>
</ul></div>
</div>
</div>
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="02-data_frames_2.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="index.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="02-data_frames_2.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: DataFrames - Part 2
        </a>
        <a class="chapter-link float-end" href="index.html" rel="next">
          Home
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/carpentries/workbench-template-rmd/edit/main/episodes/03-image_handling.Rmd" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/carpentries/workbench-template-rmd/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/carpentries/workbench-template-rmd/" class="external-link">Source</a></p>
				<p><a href="https://github.com/carpentries/workbench-template-rmd/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:team@carpentries.org">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/69aaefee46a17928e2a1694825599e169b9793e3" class="external-link">sandpaper (0.16.10)</a>, <a href="https://github.com/carpentries/pegboard/tree/bad0be19a12f0c6545801b276ddf26c945f8bfd1" class="external-link">pegboard (0.7.7)</a>, and <a href="https://github.com/milanmlft/varnish/tree/milanmlft/sticky-sidebar" class="external-link">varnish (1.0.3.9000)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://carpentries.github.io/workbench-template-rmd/03-image_handling.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "Image Handling",
  "creativeWorkStatus": "active",
  "url": "https://carpentries.github.io/workbench-template-rmd/03-image_handling.html",
  "identifier": "https://carpentries.github.io/workbench-template-rmd/03-image_handling.html",
  "dateCreated": "2022-06-14",
  "dateModified": "2025-01-05",
  "datePublished": "2025-01-05"
}

  </script><script>
		feather.replace();
	</script></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

